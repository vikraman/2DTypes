\ProvidesPackage{macros}

\RequirePackage{xcolor}
\RequirePackage{xcolor-solarized}
\RequirePackage{xparse}
\RequirePackage{amsmath}
\RequirePackage{braket}
\RequirePackage{etoolbox}
\RequirePackage{mathtools}
\RequirePackage{array}
\RequirePackage{xspace}
\RequirePackage{perfectcut}
\RequirePackage{stackengine}
\RequirePackage{graphicx}

% eucal keeping mathcal
\let\oldmathcal\mathcal
\RequirePackage{eucal}
\let\matheucal\mathcal
\let\mathcal\oldmathcal

\RequirePackage{hott}

% misc
\newcommand{\todo}[1]{\textcolor{solarized-red}{TODO: {#1}}}
\newcommand{\note}[1]{\textcolor{solarized-orange}{NOTE: {#1}}}
\newcommand{\amr}[1]{\textcolor{solarized-blue}{AS: {#1}}}
\newcommand{\jk}[1]{\textcolor{solarized-cyan}{JK: {#1}}}
\newcommand{\vc}[1]{\textcolor{solarized-magenta}{VC: {#1}}}
\newcommand{\review}[1]{\textcolor{solarized-red}{#1}}

% text
\let\ps\perfectparens%

\newcommand{\Nat}[0]{\mathbb{N}}
\newcommand{\zero}[0]{\term{0}}
\NewDocumentCommand{\suc}{O{}}{\term{S}{#1}}
\newcommand{\fac}[1]{{#1}\,!}

\newcommand{\highlight}[1]{\textcolor{solarized-orange}{#1}}
\newcommand{\highlightAlt}[1]{\textcolor{solarized-magenta}{#1}}

% finite types
\NewDocumentCommand{\Fin}{O{}}{\type{Fin{\ifstrempty{#1}{}{_{\mathsmaller{#1}}}}}}
\NewDocumentCommand{\FinExcept}{mO{}}{\term{Fin_{\mathsmaller{#1}}^{-}}\ifstrempty{#2}{}{({#2})}}
\newcommand{\fzero}{\zero}
\NewDocumentCommand{\isFin}{O{}}{\term{isFin}\ifstrempty{#1}{}{({#1})}}

\newcommand{\encode}[1]{\mathop{\term{encode_{#1}}}}
\newcommand{\encodePerm}{\encode{perm}}
\newcommand{\encodeSn}{\encode{\Sn}}
\newcommand{\decode}[1]{\mathop{\term{decode_{#1}}}}
\newcommand{\decodePerm}{\decode{perm}}
\newcommand{\decodeSn}{\decode{\Sn}}

% permutations
\newcommand{\el}[1]{\mathbf{#1}}

% immersion
\newcommand{\immersion}{\term{\mathfrak{em}}}

% lehmer codes
\NewDocumentCommand{\Lehmer}{O{}}{\term{Lehmer}\ifstrempty{#1}{}{({#1})}}
\newcommand{\lzero}{\term{L0}}
\NewDocumentCommand{\lsuc}{O{}}{\term{LS}\ifstrempty{#1}{}{({#1})}}
\newcommand{\invcount}[1]{\term{inv}(#1)}

% symmetric group
\NewDocumentCommand{\Sn}{O{n}}{\type{S_{#1}}}
\NewDocumentCommand{\List}{O{}}{\type{List}\ifstrempty{#1}{}{({#1})}}
\newcommand{\nil}{\term{nil}}
\newcommand{\cons}{\mathrel{\term{:}\kern -0.2em\term{:}}}
\newcommand{\inl}{\term{inl}}
\newcommand{\inr}{\term{inr}}
\newcommand{\extend}[1]{{#1}^\#}
\newcommand{\Grp}{\type{Grp}}
\NewDocumentCommand{\cox}{s}{
  \IfBooleanTF{#1}
  {\mathrel{\xlrsquigarrow{\ast}}}
  {\mathrel{\leftrightsquigarrow}}
}
\NewDocumentCommand{\longcox}{s}{
  {\mathrel{\rightsquigarrow}}
}
\NewDocumentCommand{\longcoxstar}{s}{
  {\mathrel{\xrsquigarrow{\ast}}}
}
\NewDocumentCommand{\longcoxplus}{s}{
  {\mathrel{\xrsquigarrow{+}}}
}
\NewDocumentCommand{\longcoxinv}{s}{
  \IfBooleanTF{#1}
  {\mathrel{{}^{\ast}\leftsquigarrow}}
  {\mathrel{\leftsquigarrow}}
}
\newcommand{\cancel}{\term{cancel}}
\newcommand{\swap}{\term{swap}}
\newcommand{\braid}{\term{braid}}
\newcommand{\longcancel}{\term{{cancel}^{\vardiamondsuit}}}
\newcommand{\longswap}{\term{{swap}^{\vardiamondsuit}}}
\newcommand{\longbraid}{\term{{braid}^{\vardiamondsuit}}}
\newcommand{\downf}{\mathrel{\swarrow}}
\newcommand{\reflr}[1]{\term{{#1}-refl}}
\newcommand{\symr}[1]{\term{{#1}-sym}}
\newcommand{\transr}[1]{\term{{#1}-trans}}
\newcommand{\congrf}[2]{\term{{#1}-cong-{#2}}}
\newcommand{\relr}[1]{\term{{#1}-rel}}
\newcommand{\append}{\mathrel{+\kern -0.4em+}}

\NewDocumentCommand{\gspan}{O{}O{}mmm}{
  \begin{tikzcd}[ampersand replacement=\&]
    \& {#3} \\
    {#4} \&\& {#5}
    \arrow["{#1}"', squiggly, from=1-2, to=2-1]
    \arrow["{#2}", squiggly, from=1-2, to=2-3]
  \end{tikzcd}
}

\NewDocumentCommand{\rspan}{O{\rightarrow}mmm}{
  \begin{tikzcd}[ampersand replacement=\&]
    \& {#2} \\
    {#3} \&\& {#4}
    \arrow["{#1}"{marking,rotate=180}, draw=none, from=1-2, to=2-1]
    \arrow["{#1}"{marking}, draw=none, from=1-2, to=2-3]
  \end{tikzcd}
}
\NewDocumentCommand{\rcospan}{O{\rightarrow}mmm}{
  \begin{tikzcd}[ampersand replacement=\&]
    {#2} \&\& {#3} \\
    \& {#4}
    \arrow["{#1}"{marking}, draw=none, from=1-1, to=2-2]
    \arrow["{#1}"{marking,rotate=180}, draw=none, from=1-3, to=2-2]
  \end{tikzcd}
}

\NewDocumentCommand{\coxspan}{smmm}{
  \IfBooleanTF{#1}
  {{#3} \xlsquigarrow{\ast} {#2} \xrsquigarrow{\ast} {#4}}
  {{#3} \leftsquigarrow {#2} \rightsquigarrow {#4}}
}
\NewDocumentCommand{\coxcospan}{smmm}{
  \IfBooleanTF{#1}
  {{#2} \xrsquigarrow{\ast} {#4} \xlsquigarrow{\ast} {#3}}
  {{#2} \rightsquigarrow {#4} \leftsquigarrow {#3}}
}
\NewDocumentCommand{\coxdiamond}{smmmm}{
  \begin{tikzcd}[ampersand replacement=\&]
    \& {#2} \\
    {#3} \&\& {#4} \\
    \& {#5}
    \IfBooleanTF{#1}
    {\arrow["{\ast}"', squiggly, from=2-1, to=3-2]}
    {\arrow[squiggly, from=2-1, to=3-2]}
    \IfBooleanTF{#1}
    {\arrow["{\ast}", squiggly, from=2-3, to=3-2]}
    {\arrow[squiggly, from=2-3, to=3-2]}
    \IfBooleanTF{#1}
    {\arrow["{\ast}"', squiggly, from=1-2, to=2-1]}
    {\arrow[squiggly, from=1-2, to=2-1]}
    \IfBooleanTF{#1}
    {\arrow["{\ast}", squiggly, from=1-2, to=2-3]}
    {\arrow[squiggly, from=1-2, to=2-3]}
  \end{tikzcd}
}
\newcommand{\normf}{\term{\mathfrak{nf}}}

\newcommand{\mult}{\mathrel{\cdot}}
\newcommand{\reverse}{\term{reverse}}

% math
\newcommand{\SetFin}{\matheucal{S}\mathrm{et_{fin}}}
\newcommand{\BFin}{\matheucal{B}}
\newcommand{\SetCat}{\matheucal{S}\mathrm{et}}
\newcommand{\CatCat}{\matheucal{C}\mathrm{at}}
\newcommand{\SymMonCat}{\matheucal{S}\mathrm{ymMonCat}}
\NewDocumentCommand{\FSM}{O{}}{\matheucal{F}{_\mathrm{\mathsmaller{SM}}}\ifstrempty{#1}{}{({#1})}}
\newcommand{\CCat}[1]{\mathcal{#1}}

% custom arrows

\renewcommand{\leftsquigarrow}{%
  \mathrel{\mathpalette\reflect@squig\relax}%
}
\newcommand{\reflect@squig}[2]{%
  \reflectbox{$\m@th#1\rightsquigarrow$}%
}
\newcommand{\xlsquigarrow}[1]{
  \mathrel{\stackon[2pt]{$\leftsquigarrow$}{$\mathsmaller{#1}$}}
}
\newcommand{\xrsquigarrow}[1]{
  \mathrel{\stackon[2pt]{$\rightsquigarrow$}{$\mathsmaller{#1}$}}
}
\newcommand{\xlrsquigarrow}[1]{
  \mathrel{\stackon[2pt]{$\leftrightsquigarrow$}{$\mathsmaller{#1}$}}
}
